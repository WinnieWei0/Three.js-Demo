<!DOCTYPE html>
<html lang="en">

<head>
  <title></title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no,
			minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      font-family: Monospace;
      background-color: #000;
      color: #fff;
      margin: 0px;
      overflow: hidden;
    }

    #info {
      color: #fff;
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      z-index: 100;
      display: block;
    }

    #info a,
    .button {
      color: #f00;
      font-weight: bold;
      text-decoration: underline;
      cursor: pointer
    }

    .btnSel {
      position: absolute;
      top: 50px;
      right: 30px;
    }
  </style>
</head>

<body>
  <div id="info">
  </div>
  <div class="btnSel">
    <button id="btnA">a.jpg</button>
    <button id="btnB">b.jpg</button>
    <button id="btnC">c.jpg</button>
  </div>
  <script src="/js/three.min.js"></script>

  <script src="/lib/TrackballControls.js"></script>
  <script src="/lib/Detector.js"></script>
  <script src="/lib/PLYExporter.js"></script>

  <script>
    if (!Detector.webgl) Detector.addGetWebGLMessage(); //兼容
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix(); //更新相机投影矩阵
      renderer.setSize(window.innerWidth, window.innerHeight);
      controls.handleResize();
    }
    draw()
    var renderer, container

    function initRender() {
      renderer = new THREE.WebGLRenderer({
        antialias: true //是否抗锯齿
      });
      renderer.setClearColor(0x000000, 1); //设置颜色及透明度
      renderer.setSize(window.innerWidth, window.innerHeight);
      container = document.createElement('div');
      document.body.appendChild(container);
      container.appendChild(renderer.domElement);
    }

    var scene

    function initScene() {
      scene = new THREE.Scene();
      scene.add(camera);
    }

    var camera

    function initCamera() {
      camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.01, 1e10);
      camera.position.set(0, 40, 50)
    }
    var controls

    function initControls() {
      controls = new THREE.TrackballControls(camera);
      controls.rotateSpeed = 3; //旋转速度
      controls.zoomSpeed = 3; //缩放/移动速度
      controls.panSpeed = 1; //平移速度
    }

    function initGeometry() {
      var geometry = new THREE.BoxGeometry(1, 1, 1)
      var material = new THREE.MeshBasicMaterial({
        color: 0xff0000
      })
      var cube = new THREE.Mesh(geometry, material)
      scene.add(cube)
    }

    function animate() {
      renderer.render(scene, camera);
      controls.update();
      requestAnimationFrame(animate);
    }

    function initGLTFExporter() {
      let gltfExporter = new THREE.PLYExporter();
      // 单个模型数据 obj
      gltfExporter.parse(scene, function (result) {
        console.log(result);
        let link = document.createElement('a');
        link.style.display = 'none';
        document.body.appendChild(link);
        link.href = URL.createObjectURL(new Blob([JSON.stringify(result)], { type: 'text/plain' }));
        link.download = Date.now() + '.ply';
        link.click();
        document.body.removeChild(link);
      })
      // gltfExporter.parse(scene)
      // let link = document.createElement('a');
      // link.style.display = 'none';
      // document.body.appendChild(link);
      // link.href = URL.createObjectURL(new Blob([JSON.stringify(result)], {
      //   type: 'text/plain'
      // }));
      // link.download = Date.now() + '.ply';
      // link.click();
      // document.body.removeChild(link);
    }

    function draw() {
      initCamera();
      initScene();
      initGeometry()
      initControls();
      initRender();
      animate();
      initGLTFExporter()

      window.addEventListener('resize', onWindowResize, false); //窗口调整
    }
  </script>

</body>

</html>